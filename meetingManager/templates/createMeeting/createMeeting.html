{% extends "base.html" %}
{% block content %}
<form method="POST" enctype="multipart/form-data">
    <div class="row">
        <div class="col">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Название</th>
                        <th scope="col">Тип</th>
                        <th scope="col">Действие</th>
                    </tr>
                </thead>
                <tbody id='researchList'>
                    {% for research in researchOnMeetinList %}
                    <tr>
                        <th scope="row"><a href="{% url 'watchResearch' research.id %}" target="_blank">{{ research }}</a></th>
                        <td>{{ research.getType }}</td>
                        <td><button type="button"  id="{{ research.id }}" class="btn btn-primary" onclick="addInMeetingList(this, 'researchInMeeting', '{{ research }}', '{{ research.id }}')">Добавить</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="col-5 text-center">
            <h3>Список исследований</h3>
            <hr>
           <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Исследование</th>
                        <th scope="col">Действие</th>
                    </tr>
                </thead>
                <tbody id="researchInMeeting">
                    <tr>
                        
                    </tr>
                </tbody>
            </table>

            <h3>Список пользователей</h3>
            <hr>
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Пользователь</th>
                        <th scope="col">Действие</th>
                    </tr>
                </thead>
                <tbody id="userInMeeting">
                    <tr>
                        
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="col">
            <table class="table">
                <thead>
                    <tr>
                        <th scope="col">Пользователь</th>
                        <th scope="col">Действие</th>
                    </tr>
                </thead>
                <tbody id="userList">
                    {% for user in userList %}
                    <tr>
                        <th scope="row">{{ user.get_full_name }}</th>
                        <td><button type="button" class="btn btn-primary" id="{{ user.id }}" onclick="addInMeetingList(this, 'userInMeeting', '{{ user }}', '{{ user.id }}')">Добавить</button></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
</form>

<script>
    function addInMeetingList(self, listId, object, objectId){
        self.disabled = true;
        var table = document.getElementById(listId);
        var faucet1 = 1;
        var tr = document.createElement("tr");
        if (faucet1 == 1) {
            if (listId == 'researchInMeeting') {
                tr.innerHTML = '<td id="'+ objectId +'_research1">' + object + '</td> <td id="'+ objectId +'_research2"><button type="button" researchId="'+ objectId + '" class="btn btn-danger" onclick="deleteInMeetingList(this, `research`, '+ objectId + ')">Удалить</button></td>';
            }
            else {
                tr.innerHTML = '<td id="'+ objectId +'_user1">' + object + '</td> <td id="'+ objectId +'_user2"><button type="button" class="btn btn-danger" onclick="deleteInMeetingList(this, `user`, '+ objectId + ')">Удалить</button></td>';
            } 
            table.appendChild(tr);
        }
        else {
            console.log('error');
        }
    }

    function deleteInMeetingList(self, type, object){
        if (type == "research") {
            var button = $("tbody#researchList").find("button#" + object)[0];
            $("#"+ object + "_research1").remove();
            $("#"+ object + "_research2").remove();
            console.log(object + "_research1")
        }
        else {
            var button = $("tbody#userList").find("button#" + object)[0];
            $("#"+ object + "_user1").remove();
            $("#"+ object + "_user2").remove();
        }
        button.disabled = false;
    }
</script>
{% endblock %}